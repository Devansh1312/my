{% extends 'base.html' %}
{% load custom_filters %}
{% load static %}
{% load sass_tags %}

{% block css %}
<!-- Plugins css start-->
<link rel="stylesheet" type="text/css" href="{% sass_src 'assets/scss/vendors/datatables.scss' %}">
<link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">
<!-- Plugins css Ends-->

<style>
    .profile-info .label-value {
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: 5px 0;
    }

    .card-header, .card-body {
        padding: 1.5rem;
    }

    .card-footer {
        text-align: right;
        padding: 1rem;
    }

    /* Ensure the back button is at the end of the large card */
    .card-footer a.btn-secondary {
        display: inline-block;
        margin-top: 20px;
    }
</style>
{% endblock %}

{% block title %} {{title}} | Page {% endblock %}

{% block content %}
<div class="page-body">
      <!-- Big Card -->
      <div class="card" style="margin-top:100px;">
         <div class="card-body">
            <div class="row">
               <!-- Profile Information -->
               <div class="col-xl-12">
                  <div class="card">
                     <div class="card-header">
                        <h4 class="card-title mb-0">Profile Details</h4>
                     </div>
                     <div class="card-body">
                        <div class="profile-info text-center mb-3">
                           <img class="img-70 rounded-circle" alt="Profile Picture" src="{% if user.profile_picture %}{{ user.profile_picture.url }}{% else %}{% static 'assets/images/user/7.jpg' %}{% endif %}">
                        </div>
                        <div class="row">
                           <div class="col-4 label-value">
                              <p>Full Name:{{ user.fullname }}</p>
                           </div>
                           <div class="col-4 label-value">
                              <p>Role: {{ user.role.name_en }}</p>
                           </div>
                           <div class="col-4 label-value">
                              <p>Date of Birth: {{ user.date_of_birth|default:"None" }}</p>
                           </div>
                           <div class="col-4 label-value">
                              <p>Email: {{ user.email|default:"None" }}</p>
                           </div>
                           <div class="col-4 label-value">
                              <p>Phone: {{ user.phone|default:"None" }}</p>
                           </div>
                           <div class="col-4 label-value">
                              <p>Gender: {{ user.gender.name|default:"None" }}</p>
                           </div>
                           <div class="col-4 label-value">
                              <p>Country: {{ user.country.name|default:"None" }}</p>
                           </div>
                           <div class="col-4 label-value">
                              <p>City: {{ user.city.name|default:"None" }}</p>
                           </div>
                           <div class="col-4 label-value">
                              <p>Nationality: {{ user.nationality|default:"None" }}</p>
                           </div>
                        </div>
                     </div>
                  
                     <div class="card-header">
                        <h4 class="card-title mb-0">Additional Information</h4>
                     </div>
                     <div class="card-body">
                        <div class="row">
                           <div class="col-md-4 label-value">
                              <p>Weight: {{ user.weight|default:"None" }}</p>
                           </div>
                           <div class="col-md-4 label-value">
                              <p>Height: {{ user.height|default:"None" }}</p>
                           </div>
                           <div class="col-md-4 label-value">
                              <p>Main Playing Position: {{ user.main_playing_position|default:"None" }}</p>
                           </div>
                           <div class="col-md-4 label-value">
                              <p>Secondary Playing Position: {{ user.secondary_playing_position|default:"None" }}</p>
                           </div>
                           <div class="col-md-4 label-value">
                              <p>Playing Foot: {{ user.playing_foot|default:"None" }}</p>
                           </div>
                           <div class="col-md-4 label-value">
                              <p>Favourite Local Team: {{ user.favourite_local_team|default:"None" }}</p>
                           </div>
                           <div class="col-md-4 label-value">
                              <p>Favourite Team: {{ user.favourite_team|default:"None" }}</p>
                           </div>
                           <div class="col-md-4 label-value">
                              <p>Favourite Local Player: {{ user.favourite_local_player|default:"None" }}</p>
                           </div>
                           <div class="col-md-4 label-value">
                              <p>Favourite Player: {{ user.favourite_player|default:"None" }}</p>
                           </div>
                           <!-- Bio on its own line -->
                           <div class="col-12">
                              <label>Bio:</label>
                              <p>{{ user.bio|default:"None" }}</p>
                           </div>
                        </div>
                     </div>
                  </div>
               </div>
            </div>
         </div>

         <!-- Datatable Section -->
         <div class="row">
            <div class="col-sm-12">
               <div class="card">
                  <div class="card-body">
                     <!-- Add tab navigation -->
                     <ul class="nav nav-tabs" id="dataTab" role="tablist">
                        <li class="nav-item">
                           <a class="nav-link active" id="post-tab" data-toggle="tab" href="#post" role="tab" aria-controls="post" aria-selected="true">Post</a>
                        </li>
                        <li class="nav-item">
                           <a class="nav-link" id="event-tab" data-toggle="tab" href="#event" role="tab" aria-controls="event" aria-selected="false">Event</a>
                        </li>
                     </ul>
   
                     <div class="tab-content" id="dataTabContent">
                        <!-- Post Tab Content -->
                        <div class="tab-pane fade show active" id="post" role="tabpanel" aria-labelledby="post-tab">
                           <div class="table-responsive">
                              <table class="display" id="post-table">
                                 <thead>
                                    <tr>
                                       <th>No</th>
                                       <th>Post Title</th>
                                       <th>Description</th>
                                       <th>Image</th>
                                       <th>date created</th>
                                    </tr>
                                 </thead>
                                 <tbody>
                                    {% for post in posts %}
                                    <tr>
                                       <td>{{ forloop.counter }}</td>
                                       <td>{{ post.title }}</td>
                                       <td>
                                          {% if post.creator_type == post.USER_TYPE %}
                                              {{ post.description }}
                                          {% else %}
                                             invalid
                                          {% endif %}
                                       </td>
                                       <td>
                                          {% if post.media_type == 1 %}
                                              {% if post.image %}
                                                  <img src="{{ post.image.url }}" alt="{{ post.title }}" width="100" height="100">
                                              {% else %}
                                                  No Image
                                              {% endif %}
                                          {% elif post.media_type == 2 %}
                                              {% if post.image %}
                                                  <video width="200" height="100" controls>
                                                      <source src="{{ post.image.url }}" type="video/mp4">
                                                      Your browser does not support the video tag.
                                                  </video>
                                              {% else %}
                                                  No Video
                                              {% endif %}
                                          {% else %}
                                              No Media
                                          {% endif %}
                                      </td>                                      
                                       <td>{{ post.date_created|date:"d-M-Y" }}</td>
                                    </tr>
                                    {% endfor %}
                                 </tbody>
                              </table>
                           </div>
                        </div>
   
                        <!-- Event Tab Content -->
                        <div class="tab-pane fade" id="event" role="tabpanel" aria-labelledby="event-tab">
                           <div class="table-responsive">
                              <table class="display" id="event-table">
                                 <thead>
                                    <tr>
                                       <th>Event Name</th>
                                       <th>Type</th>
                                       <th>Date</th>
                                    </tr>
                                 </thead>
                                 <tbody>
                                    {% for event in events %}
                                    <tr>
                                       <td>{{ event.event_name }}</td>
                                       <td>{{ event.event_type }}</td>
                                       <td>{{ event.event_date }}</td>
                                    </tr>
                                    {% endfor %}
                                 </tbody>
                              </table>
                           </div>
                        </div>
                     </div>
                  </div>
               </div>
            </div>
         </div>
      </div>
   </div>
{% endblock %}

{% block scriptcontent %}
<!-- Plugins JS start-->
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.bundle.min.js"></script>
<script src="{% static 'assets/js/datatable/datatables/jquery.dataTables.min.js' %}"></script>
<script src="{% static 'assets/js/datatable/datatables/datatable.custom.js' %}"></script>
<script src="{% static 'assets/js/tooltip-init.js' %}"></script>
<!-- Plugins JS Ends-->

<script>
$(document).ready(function() {
   // Initialize datatables for both tables
   $('#post-table').DataTable();
   $('#event-table').DataTable();

   // Adjust DataTables when tabs are switched
   $('#dataTab a').on('shown.bs.tab', function (e) {
      var target = $(e.target).attr("href"); 
      if (target === "#post") {
         $('#post-table').DataTable().columns.adjust().draw(); 
      } else if (target === "#event") {
         $('#event-table').DataTable().columns.adjust().draw(); 
      }
   });
});
</script>

{% endblock %}